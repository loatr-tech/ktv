(this.webpackJsonpktv=this.webpackJsonpktv||[]).push([[0],{45:function(e,t,n){},49:function(e,t,n){},51:function(e,t,n){},53:function(e,t,n){},58:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var c=n(2),o=n.n(c),s=n(38),a=n.n(s),r=(n(45),n(46),n(47),n(14)),i=n(4),l=(n(49),n(7)),j=n(20),b=n(25);n(79);b.a.initializeApp({apiKey:"AIzaSyAZ3DKq0vI256yimaad4iUp0uML33m07Yo",authDomain:"loatr-tech-ktv.firebaseapp.com",projectId:"loatr-tech-ktv",storageBucket:"loatr-tech-ktv.appspot.com",messagingSenderId:"580571065570",appId:"1:580571065570:web:a0f122923e4800aa2742bb",measurementId:"G-XQY5SYQYEV"});var d=b.a,u=n(1),h=Object(c.createContext)({});function m(e){var t=Object(c.useState)(),n=Object(l.a)(t,2),o=n[0],s=n[1],a=Object(c.useState)("kcuRCauZPqfaoLCLcjDP"),r=Object(l.a)(a,2),i=r[0],b=r[1],m=Object(c.useState)([]),O=Object(l.a)(m,2),p=O[0],f=O[1];Object(c.useEffect)((function(){var e=d.firestore().collection("rooms").doc(i).collection("songs").orderBy("position","asc").onSnapshot((function(e){var t=e.docs.map((function(e){return Object(j.a)({id:e.id},e.data())}));f(t)}));return function(){return e()}}),[i]);return Object(u.jsx)(h.Provider,{value:{room:o,setRoom:s,roomId:i,setRoomId:b,songs:p,updateSongProps:function(e,t){return d.firestore().collection("rooms").doc(i).collection("songs").doc(e).update(t)},addSong:function(e){return d.firestore().collection("rooms").doc(i).collection("songs").add(e)},removeFirstSong:function(){if(p.length)return d.firestore().collection("rooms").doc(i).collection("songs").doc(p[0].id).delete()}},children:e.children})}n(51);var O=function(){var e=Object(c.useContext)(h),t=e.songs,n=e.updateSongProps,o=e.removeFirstSong,s=Object(c.useState)(),a=Object(l.a)(s,2),r=a[0],i=a[1],j=Object(c.useState)(),b=Object(l.a)(j,2),d=b[0],m=b[1],O=Object(c.useState)(),p=Object(l.a)(O,2),f=p[0],x=p[1];return Object(c.useEffect)((function(){0===f&&r&&(t.length>1?r.loadVideoById(t[1].videoId):r.loadVideoById("BHACKCNDMW8"),t.length&&o(),x(1))}),[f,t,r,o]),Object(c.useEffect)((function(){var e=document.createElement("script");e.id="youtube-iframe-api",e.src="https://www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),window.onYouTubeIframeAPIReady=function(e){new window.YT.Player("ktv-youtube-iframe",{videoId:"BHACKCNDMW8",events:{onReady:function(e){e.target.playVideo(),i(e.target)},onStateChange:function(e){var t=e.data;x(t)}}})}}),[]),Object(c.useEffect)((function(){if(r&&t.length){var e=t[0];(null===d||void 0===d?void 0:d.videoId)!==e.videoId&&(r.loadVideoById(e.videoId),t.length>1&&n(e.id,{position:e.position-1e3}),m(e))}}),[r,t,d,n]),Object(u.jsxs)("div",{className:"room-container",children:[Object(u.jsx)("section",{className:"room-iframe-wrapper",children:Object(u.jsx)("div",{className:"room-iframe-container",children:Object(u.jsx)("div",{id:"ktv-youtube-iframe",className:"room-iframe",tabIndex:-1})})}),Object(u.jsxs)("section",{children:[Object(u.jsx)("button",{onClick:function(){r.playVideo()},children:"Play"}),Object(u.jsx)("button",{onClick:function(){x(0)},children:"Skip"})]})]})},p=n(18),f=n.n(p),x=n(22);n(53);var g=function(){var e=Object(c.useContext)(h),t=e.songs,n=e.removeFirstSong,o=Object(c.useState)(!1),s=Object(l.a)(o,2),a=s[0],i=s[1],j=function(){var e=Object(x.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(!0),e.next=3,n();case 3:setTimeout((function(){i(!1)}),300);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(u.jsxs)("div",{className:"remote-container",children:[Object(u.jsxs)("section",{className:"remote-links",children:[Object(u.jsxs)(r.b,{to:"/remote/playing",className:"btn btn-lg btn-primary",children:["\u6b63\u5728\u64ad\u653e ",Object(u.jsx)("span",{className:"badge",children:t.length})]}),Object(u.jsx)(r.b,{to:"/remote/search",className:"btn btn-lg btn-warning",children:"\u70b9\u6b4c"})]}),Object(u.jsx)("section",{className:"remote-actions",children:Object(u.jsx)("button",{className:"btn btn-lg btn-".concat(t.length<2?"outline-":"","secondary"),disabled:t.length<2||a,onClick:function(){return j()},children:"\u5207\u6b4c"})})]})},v=(n(58),n(40)),y=n.n(v);n(76);function N(e,t,n){var c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise((function(o){var s=1e3;t.length>0&&(s=c&&t.length>1?t[1].position-1:t[t.length-1].position+1e3),e(Object(j.a)(Object(j.a)({},n),{},{position:s})).then((function(){o(!0)}))}))}var S=function(e){var t=Object(c.useContext)(h),n=t.songs,o=t.addSong,s=Object(c.useState)(!1),a=Object(l.a)(s,2),r=a[0],i=a[1],j=e.video,b=j.thumbnail.thumbnails,d=Object(l.a)(j.title.runs,1)[0].text;return Object(u.jsxs)("div",{className:"remote-song",children:[Object(u.jsx)("section",{className:"remote-song-header",children:d}),Object(u.jsxs)("section",{className:"remote-song-body",children:[Object(u.jsx)("div",{className:"remote-song-image",children:Object(u.jsx)("img",{src:b[b.length-1].url,alt:d})}),Object(u.jsx)("div",{className:"remote-song-actions",children:r?Object(u.jsx)("span",{children:"\u5df2\u6dfb\u52a0"}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("button",{className:"btn btn-secondary",onClick:function(){N(o,n,j).then((function(){i(!0)}))},children:"\u6dfb\u52a0"}),Object(u.jsx)("button",{className:"btn btn-secondary",onClick:function(){N(o,n,j,!0).then((function(){i(!0)}))},children:"\u7f6e\u9876"})]})})]})]})};var k=function(){var e=Object(c.useContext)(h).songs,t=Object(c.useState)(""),n=Object(l.a)(t,2),o=n[0],s=n[1],a=Object(c.useState)([]),i=Object(l.a)(a,2),j=i[0],b=i[1],d=Object(c.useCallback)(Object(x.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=6;break}return e.next=3,y.a.get("https://loatr-tech-api.herokuapp.com/ktv/search",{params:{query:o}});case 3:t=e.sent,n=t.data,b(n);case 6:case"end":return e.stop()}}),e)}))),[o]);return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("header",{className:"remote-search-header",children:[Object(u.jsx)(r.b,{to:"/remote",className:"btn btn-light",children:"\u8fd4\u56de"}),Object(u.jsxs)(r.b,{to:"/remote/playing",className:"btn btn-primary",children:["\u6b63\u5728\u64ad\u653e ",Object(u.jsx)("span",{className:"badge",children:e.length})]})]}),Object(u.jsxs)("div",{className:"container",children:[Object(u.jsxs)("div",{className:"input-group remote-search-box",children:[Object(u.jsx)("input",{type:"text",className:"form-control",placeholder:"Search song",value:o,onChange:function(e){return s(e.target.value)}}),Object(u.jsx)("button",{className:"btn btn-outline-success",type:"button",onClick:d,children:"Search"})]}),Object(u.jsx)("section",{children:j.map((function(e){return Object(u.jsx)(S,{video:e},e.videoId)}))})]})]})};n(77);var C=function(){var e=Object(c.useContext)(h),t=e.songs,n=e.updateSongProps;return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("header",{className:"remote-playing-header",children:[Object(u.jsx)(r.b,{to:"/remote",className:"btn btn-light",children:"\u8fd4\u56de"}),Object(u.jsx)("span",{children:"\u64ad\u653e\u5217\u8868"})]}),Object(u.jsxs)("table",{className:"table remote-playing-table",children:[Object(u.jsx)("thead",{children:Object(u.jsxs)("tr",{children:[Object(u.jsx)("th",{scope:"col",children:"#"}),Object(u.jsx)("th",{scope:"col",children:"\u5df2\u9009\u6b4c\u66f2"}),Object(u.jsx)("th",{scope:"col"})]})}),Object(u.jsx)("tbody",{children:t.map((function(e,c){var o=Object(l.a)(e.title.runs,1)[0].text,s=null;return 0===c?s="\u6b63\u5728\u64ad\u653e":1===c&&(s="\u5373\u5c06\u64ad\u653e"),Object(u.jsxs)("tr",{className:0===c?"table-primary":"",children:[Object(u.jsx)("td",{children:c+1}),Object(u.jsx)("td",{children:o}),Object(u.jsx)("td",{children:s?Object(u.jsx)("span",{children:s}):Object(u.jsx)("button",{className:"btn btn-outline-secondary",onClick:function(){return function(e){n(e.id,{position:t[1].position-1})}(e)},children:"\u7f6e\u9876"})})]},c)}))})]})]})};var I=function(){return Object(u.jsx)(m,{children:Object(u.jsx)(r.a,{children:Object(u.jsxs)(i.c,{children:[Object(u.jsx)(i.a,{exact:!0,path:"/",children:"Homepage of ktv"}),Object(u.jsx)(i.a,{path:"/room",component:O}),Object(u.jsx)(i.a,{path:"/remote",exact:!0,component:g}),Object(u.jsx)(i.a,{path:"/remote/search",component:k}),Object(u.jsx)(i.a,{path:"/remote/playing",component:C})]})})})},w=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,80)).then((function(t){var n=t.getCLS,c=t.getFID,o=t.getFCP,s=t.getLCP,a=t.getTTFB;n(e),c(e),o(e),s(e),a(e)}))};a.a.render(Object(u.jsx)(o.a.StrictMode,{children:Object(u.jsx)(I,{})}),document.getElementById("root")),w()}},[[78,1,2]]]);
//# sourceMappingURL=main.61a59e16.chunk.js.map